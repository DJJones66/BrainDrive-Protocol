services:
  bdp-stream-router:
    image: python:3.12-slim
    working_dir: /workspace
    command: ["python", "-u", "router/router_service.py"]
    environment:
      ROUTER_PORT: "${ROUTER_PORT:-8080}"
      OLLAMA_BASE_URL: "${OLLAMA_BASE_URL:-http://host.docker.internal:11434}"
      OLLAMA_DEFAULT_MAX_TOKENS: "${OLLAMA_DEFAULT_MAX_TOKENS:-512}"
      OLLAMA_DEFAULT_STOP: "${OLLAMA_DEFAULT_STOP:-}"
      BDP_DATA_DIR: /workspace/data
      ASYNC_FALLBACK_ENABLED: "${ASYNC_FALLBACK_ENABLED:-true}"
      ASYNC_FALLBACK_MIN_CHARS: "${ASYNC_FALLBACK_MIN_CHARS:-700}"
      ASYNC_FALLBACK_ROUTE_URL: "${ASYNC_FALLBACK_ROUTE_URL:-http://host.docker.internal:8082/route_async}"
      ASYNC_FALLBACK_STATUS_BASE: "${ASYNC_FALLBACK_STATUS_BASE:-http://host.docker.internal:8082}"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    volumes:
      - ./:/workspace
    ports:
      - "${POC4_PORT:-8080}:8080"
