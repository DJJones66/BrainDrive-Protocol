services:
  router:
    image: python:3.12-slim
    working_dir: /workspace
    command: ["python", "-u", "router/router_service.py"]
    environment:
      PYTHONPATH: /workspace
      BDP_DATA_DIR: /workspace/data
      ROUTER_PORT: "8080"
      ECHO_URL: http://node-echo:8091/ancp
      LOGGER_URL: http://node-logger:8092/ancp
      ADAPTER_URL: http://node-adapter:8093/ancp
      PLANNER_URL: http://node-planner:8094/ancp
      NODE_TIMEOUT_SEC: "3.0"
    volumes:
      - ./:/workspace
    ports:
      - "${POC2_PORT:-8080}:8080"
    depends_on:
      - node-echo
      - node-logger
      - node-adapter
      - node-planner

  node-echo:
    image: python:3.12-slim
    working_dir: /workspace
    command: ["python", "-u", "services/echo/echo_service.py"]
    environment:
      PYTHONPATH: /workspace
      ECHO_PORT: "8091"
    volumes:
      - ./:/workspace

  node-logger:
    image: python:3.12-slim
    working_dir: /workspace
    command: ["python", "-u", "services/logger/logger_service.py"]
    environment:
      PYTHONPATH: /workspace
      BDP_DATA_DIR: /workspace/data
      LOGGER_PORT: "8092"
    volumes:
      - ./:/workspace

  node-adapter:
    image: python:3.12-slim
    working_dir: /workspace
    command: ["python", "-u", "services/adapter/adapter_service.py"]
    environment:
      PYTHONPATH: /workspace
      ADAPTER_PORT: "8093"
    volumes:
      - ./:/workspace

  node-planner:
    image: node:20-alpine
    working_dir: /workspace
    command: ["node", "services/planner/planner_service.js"]
    environment:
      PLANNER_PORT: "8094"
    volumes:
      - ./:/workspace
